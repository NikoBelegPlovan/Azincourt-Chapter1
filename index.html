<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vidéo plein écran + bouton retour</title>
<style>
  :root {
    --btn-bg: rgba(20,20,20,.65);
    --btn-bg-hover: rgba(20,20,20,.85);
    --btn-border: rgba(255,255,255,.25);
    --btn-color: #fff;
    --safe: env(safe-area-inset);
  }
  html, body { height: 100%; margin: 0; background:#000; color:#fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  .center { display:flex; align-items:center; justify-content:center; height:100%; flex-direction:column; gap:20px; }
  .start { font-size:1.15rem; padding:.8rem 1.2rem; border:0; border-radius:12px; cursor:pointer; background:#d11a2a; color:#fff; }
  .wrap {
    position: relative;
    width: 100vw; height: 100vh;
    background: #000; display: none; overflow:hidden;
  }
  .player {
    position:absolute; inset:0; width:100%; height:100%; border:0; background:#000;
    object-fit: contain;
  }
  .overlay {
    position:absolute; z-index:10;
    top: max(12px, env(safe-area-inset-top)); right: max(12px, env(safe-area-inset-right));
    display:flex; align-items:center; gap:.5rem;
    padding:.5rem .75rem; border-radius:999px; border:1px solid var(--btn-border);
    background: var(--btn-bg); color: var(--btn-color);
    backdrop-filter: blur(4px);
    cursor:pointer; user-select:none;
  }
  .overlay:hover { background: var(--btn-bg-hover); }
  .overlay svg { width:18px; height:18px; opacity:.9; }
  .hint { color:#bbb; font-size:.95rem; text-align:center; max-width:90ch; padding:0 16px; }
</style>
</head>
<body>

<div class="center">
  <button class="start" id="startBtn">▶ Démarrer en plein écran</button>
  <div class="hint">Un bouton discret restera visible pendant toute la vidéo pour revenir à la timeline.</div>
</div>

<div class="wrap" id="fsWrap">
  <div class="overlay" id="backBtn" title="Retour à la timeline">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 14l-4-4 4-4"/>
      <path d="M20 20h-7a4 4 0 0 1-4-4V4"/>
    </svg>
    <span style="font-size:.95rem;">Retour</span>
  </div>
  <video id="mp4Player" class="player" controls playsinline preload="auto" style="display:none;"></video>
</div>

<script>
  const AZINCOURT_URL = "https://sites.google.com/d/1pzV33WzrfUF31vyMYM0G6sQnDdkNvQRl/p/1WNuEVbpCrBZOYZdu7PXwjQy-c-Fau2jZ/edit";
  const MP4_URL = "";
  const YOUTUBE_URL = "https://www.youtube.com/watch?v=ZK40PfIeYII";

  const startBtn = document.getElementById('startBtn');
  const fsWrap  = document.getElementById('fsWrap');
  const backBtn = document.getElementById('backBtn');
  const mp4Player = document.getElementById('mp4Player');
  let ytIframe = null;

  function isYouTubeUrl(url) { return /youtube\.com|youtu\.be/.test(url); }

  function extractYouTubeId(url) {
    try {
      const u = new URL(url);
      if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
      if (u.pathname.startsWith('/embed/')) return u.pathname.split('/embed/')[1].split(/[?&]/)[0];
      const v = u.searchParams.get('v');
      return v || "";
    } catch { return ""; }
  }

  function createYouTubeIframe(videoId) {
    const params = new URLSearchParams({
      autoplay: '1', rel: '0', modestbranding: '1', playsinline: '1', controls: '1'
    });
    const iframe = document.createElement('iframe');
    iframe.className = 'player';
    iframe.src = `https://www.youtube.com/embed/${videoId}?${params.toString()}`;
    iframe.allow = 'autoplay; fullscreen; picture-in-picture';
    iframe.allowFullscreen = true;
    fsWrap.appendChild(iframe);
    return iframe;
  }

  async function enterFullscreen(el) {
    try {
      if (el.requestFullscreen) await el.requestFullscreen();
      else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) await el.msRequestFullscreen();
    } catch (e) {
      console.warn('Fullscreen refusé :', e);
    }
  }

  backBtn.addEventListener('click', () => {
    try { window.close(); } catch(e) {}
    window.location.href = AZINCOURT_URL || '/';
  });

  startBtn.addEventListener('click', async () => {
    fsWrap.style.display = 'block';
    document.querySelector('.center').style.display = 'none';

    if (YOUTUBE_URL && isYouTubeUrl(YOUTUBE_URL)) {
      const id = extractYouTubeId(YOUTUBE_URL);
      if (!id) { alert("URL YouTube invalide."); return; }
      ytIframe = createYouTubeIframe(id);
    } else if (MP4_URL) {
      const src = document.createElement('source');
      src.src = MP4_URL;
      src.type = 'video/mp4';
      mp4Player.appendChild(src);
      mp4Player.style.display = 'block';
      try { await mp4Player.play(); } catch(e) { console.warn('Lecture MP4 refusée:', e); }
    } else {
      alert("Aucune source vidéo configurée.");
      return;
    }

    await enterFullscreen(fsWrap);
  });
</script>

</body>
</html>
